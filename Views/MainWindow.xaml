<Window x:Class="pi_client.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:pi_client.ViewModels"
        xmlns:vm="clr-namespace:pi_client.ViewModels"
        xmlns:converters="clr-namespace:pi_client.Converters"
        Title="π-Calculus Visualizer" Height="600" Width="800">
    <Window.Resources>
        <converters:ActiveColorConverter x:Key="ActiveColorConverter"/>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="10 5"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
    </Window.Resources>
    <Window.DataContext>
        <local:MainViewModel />
    </Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Панель управления -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Background="#EEE">
            <StackPanel.Margin>
                <Thickness Left="10" Top="10" Right="10" Bottom="10"/>
            </StackPanel.Margin>
            <Button Content="Add Send" Command="{Binding AddSendCommand}" Margin="5" Padding="10,3"/>
            <Button Content="Add Receive" Command="{Binding AddReceiveCommand}" Margin="5" Padding="10,3"/>
            <Button Content="Connect" Command="{Binding ConnectCommand}" Margin="5" Padding="10,3"/>
            <Button Content="Execute" Command="{Binding ExecuteCommand}" Margin="5" Padding="10,3"/>
        </StackPanel>

        <!-- Рабочая область -->
        <Canvas Grid.Row="1" Background="White" x:Name="MainCanvas">
            <!-- Каналы (линии) -->
            <ItemsControl ItemsSource="{Binding Channels}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Line 
                            X1="{Binding Source.Position.X, Converter={StaticResource PositionConverter}}" 
                            Y1="{Binding Source.Position.Y, Converter={StaticResource PositionConverter}}"
                            X2="{Binding Target.Position.X, Converter={StaticResource PositionConverter}}" 
                            Y2="{Binding Target.Position.Y, Converter={StaticResource PositionConverter}}"
                            Stroke="{Binding IsActive, Converter={StaticResource ActiveColorConverter}}" 
                            StrokeThickness="3"
                            StrokeDashArray="{Binding IsActive, Converter={StaticResource ActiveDashConverter}}">
                            <Line.ToolTip>
                                <TextBlock Text="{Binding Name}"/>
                            </Line.ToolTip>
                        </Line>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- Процессы -->
            <ItemsControl ItemsSource="{Binding Processes}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border 
                            Width="120" 
                            Height="60" 
                            Background="{Binding IsActive, Converter={StaticResource ActiveColorConverter}}"
                            CornerRadius="4" 
                            BorderBrush="#0D47A1" 
                            BorderThickness="1"
                            Canvas.Left="{Binding Position.X}"
                            Canvas.Top="{Binding Position.Y}"
                            Cursor="Hand">
                            <Border.InputBindings>
                                <MouseBinding 
                                    MouseAction="LeftClick" 
                                    Command="{Binding DataContext.SelectProcessCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                    CommandParameter="{Binding}"/>
                            </Border.InputBindings>

                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="{Binding Name}" FontWeight="Bold" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding Channel}" Margin="0,5" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding Message}" HorizontalAlignment="Center" 
                                           Visibility="{Binding Type, Converter={StaticResource SendVisibilityConverter}}"/>
                                <TextBlock Text="{Binding Filter}" HorizontalAlignment="Center" 
                                           Visibility="{Binding Type, Converter={StaticResource ReceiveVisibilityConverter}}"/>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Canvas>
    </Grid>
</Window>